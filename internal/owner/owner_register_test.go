package owner

import (
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

func TestDecryptJWE_ShouldDecryptValidly(t *testing.T) {
	// given
	encryptedJWE := "eyJlbmMiOiJBMTI4R0NNIiwiYWxnIjoiZGlyIn0..914U_1q7qRgmah7-.4MqUDKtqo1CH2Y2JcFdsrelwHBBFOK0FJKXGqjwKCXo1XVgm0CuHDh6sBaDKDuDjtYtNW8Mrx_n7NPhWpchbL-ejwI8LWcS4VTBM0sVqMxgzNTckW2vbEXKTnTQlpF_-MIfLFANr5EskLFuUIpeZTBN_KZ5bqeMn5Uwjth0CXrQ6ec_2nSRnK7yMIShCRTjSiOBUhrT-d0tHQjbKXMpqyQ4GQYVwQ5g-wRT7vsOpBBZmw5YpuSeL32ZD7Ltl_bnKAWkis55Uj2nu6oCZN-chqMDDetHjuHYGRSf4GbrGB2mJ_T7EzUjyHVrtAUS6ZYaLTglcrwH1TZ3dIv0oeexDECfrJjvAP_VcNXmgP5OB6_kS937wquuoNgnjTNnMvL9QGNfIbUW4tL7QcGyjJ4ynQcheWAIUPu9Y73Se-9ecDnAr_Tq83EKWUFFyhQb_lTxULtRQ5GqrC-vYeIXy63BsJqSUwr1hPNXP6Pm3_IJzwK4HtjyZWwQzxH3gBogDhP39MB5eRCkUPHaMyLyGZ1PYEUlrXabZp0BsxIDqK6sWlNj0JP63diHb8INLR7ysGD2SMOzsuxfhJtzCnK2SHK5hNOSXpcDYd1mWcKz1lh_iCPk--AYqGX27r2Doa06jFDqeMt31zrulDbwwQgW-_wKtY6VRk-Yb-M8_Dpy-qZFt1GzTObYCa9ovIFqDbt5hUPa_e2EYBesGoDHG4GXz_e4d4ACObJSSxCBt0s9ywgviw-7Oc6aRy6z8u_bqrY315kbQcRI4mFLgWPHgHDZOtEbJDxk-uXdg0DlrecMh2VP1Gfn3JUVCy3TUlc_f-grnQfUWgMrcI0c1jx49rzoVBx7sg0o1jzwQyozYRwKWekS2r-Xi3z1218yfwFNYImaaJgvjbooyvb_gMD3H2Gd6nktLS9hEpaUvJ4rhNiFNgsYuBSg4Pv6u9DPsZyeUDUcUBhX_oh931IVaZj81ZPkfSLuiHWwpNAkhA6KAqn0xl8MSBOMakcY6hZfDSGQwdBBIaCGq_ryRRTDP26Y8LeOt0Kny5qP-b7RcHsiR0gfvrrfqWBE9u9jiMvR5mOnGUKHegSjQpyrSbQO-y-GrX5a_r4_fPWNzyWHXhq88-KfqEegdSxEU4TR4ji2hD1ofhvCQFXstjT6B96YyLxN9855yUzZCjCSFbJ2MVpAnIoVlTiLtLBRTSqkfOI58S5XLw_Bgx98C6cD13XuTs30VnKf28_bDxkyuGqezrTVBjRSSjmKma8KzOpD_97ZO9EZkr2AT5MerN4-_gCbhxthL19HB-RnPHhMHf04KTLmfqojfLeljOobSRMpPkA.X-BZvdm7Nw48ckMrX2cWnA"
	// encryptedJWE := "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0.1.1Y5iVqv-DvY5Wde5.8hngWHBtz0cRo0A2EIvB87awRrfOqhiYCn29u7J8gprIjqtWQ6wt9ls7FZ_u-w-2pDdBbu779jfzcFCFqZ-_xHd0DW2j7IRxnlxBC6FrkHXsnD9fK_SAenyI2HIyyq_pnRPtCOghyMAGKx24pQpi4Z2Ak-UFR9NTCgo9RyZ3ekYGT325M6zAQtzL0m61XykLWriz3WJ2aKeC0lJIUDx8Y-3LedmigpTDmdgSSi7Y8QpQswXYQijfup6JuEXYH_ZDTNcsQYnOi_SFPViqfTcGBeaNXhX9H9nmGt2Ibo_ShEqyBXMZiS9CMawpKM7XPj0cvrO-d_sFaW_5ulsr4iaOoWA5-AEJe_gqUoa5GE1O-CawTR3Cx-THGHihOnVoRI3QN7fx7HMjTb0Cxb1EyE8m8uzTpbYK0arRpXsxa0SRpHqdXX7BRfqU1mBrNDjC3QubCTASTJ-0E0NpuJjprPJIYP78SENzKql5FzHxvF3KYOqBSRrj92mn15kxmYLGw1J2gkxcieHA2-_AlEiwZ5eocvy1CuXQ_-0o7ZnpwPxbh3ZcdYTHmjQCa0uw9I2V-yqjaFdPfnaqHDbFT6cOf3LEHAfaRDbhJpyFxqKMRnixXrRkwD3DV-2eMIDnZ9R9-1DJ5Oy7HtIXSLTI-PYN5WB-vrI61a9APgGWplA3wMD1y54QmTDTm_WG-2Eb3XvfFfgnMpw2YM1O35N3D8OLE5BQel6JMqcU8pY5W8Uov0e5tfepBMjvI7vZME40V34S_59bKF-ddeuflaEe1apBlgoqTJK36BpaPuTLawhgzu6IrLP16p53qP0iUZrCPxEaYtV7nNqhEqbzXn0pd-BYsivLD4IKDFxljgJj1F6Rhw-QdQFfiiWhGiMfMQn0K6vG3LuenS4dIEdz8Eu1NbZF5yju6xwN002UcSlhZiMnwJvQF31wai3ueuZArvAGKsG6aQO-JsXZqi9No2-hExNiMoUbbqjLNU-6Lceqb41YbupXtFfaGPWKTpQxCG6d-2htceZuNleO7dH-TuBC7OEa1A0LsZN6QYpwiWHeWBGVKOaHkACTp13nc4_8m-d6-fVgKlmOqcbZ6eDVbgJrM4ajYna557_-oBVPlITq3ndoL05zs2KQrT27HvNsN1RNrCa6wCJIK2jiiut1t_jmxBf5a8nw1yn7aN7Jv6JGfkziJT_rVJZaLTrh9sQcGMrcDli37XAlNihUf-kYtorkAkF5jxza6smhIim-mYm9c0wCHEBxekta8Eeb3iHCVdTyFy9ulbJBj8u_Dkj4CpwQYRtb4KXj5enEIMUNM43EfTvTMqGowSJhQ99jei1Vk0hTS0-UUfd7Z9QmiOFqWHGZ2zn66C29quoqbP3GyTKCLE5DKIGMfeFzaMQW3JaeFg.qJR4FwBwpkbVb1kxKOclkw"
	expectedClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiJ9.eyJwdWJsaWNLZXkiOiItLS0tLUJFR0lOIFJTQSBQVUJMSUMgS0VZLS0tLS1cbk1JSUJDZ0tDQVFFQXRUM2dKQXp2ck5kNHlrTE5GRlN2ZHQvc2owUGpZL3ZmY3R2a003MExWL01rSGZIQTZ2NExcbmdpS3E2TEdYMFlHVERiS0cyRG5hc2JqS3ZwelhDQlR1YnBlUXl4TnI4QnNUL25sVmZQajBRRTZOa2NGcVVqTGVcbkUvaWZldFlwUUtkb1VQRllkSXdUZGZkV3pIN1g4OHIvRkJpSFdZakY1NDEydDVCek9mQkZYMEhoNlpJbkl3clVcbktKZUpBVXljZXFVbGdOWkE0b3k4YkR4TjZkNmdFeHZuYmlOa1lLdzJVN2ZWc25CSzlpajZiSjJYWmRBSlV6TEZcbk1MUWc0SW5LeXB5RzNXVitSZXlKQzlFY0p5NnRuZk82NHJtd0tlQTl1a2J1aXFva1laM2I1NE5pMkZTVGdaaUdcbno2aVBXMURqWFg5WXhSSVNoTHpZMkJzazU4dHVUWUdTMXdJREFRQUJcbi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTc1MjE1NDkzN30.LLD-jQJmw3oEX-RYv8bO0wW5aG3FkeIlTU9lq17nPtXWB9Ino5kzrBKU8Dm8RcD3juj2HA-bfo8_fNj8TW2Xvt1yPQqanIxfL2q0t4aNroysel9Ue2A6ctr5dFDQE2UINzNa8t6kZM6Stdgz5FGhOKbS-3ZmYcKNdAD182-uJwgD3MEbFIEvfoGYbTdx5E3BulJWEDLnuWZpnmm1p4oZ83pEUuOYC8h6jD2PBPEBrPSeGK9ojCV6n6JkOk6nASzn0SSZycoKhyrG7efy3emC4s6QbHIa47ehVARMIOyl4SaNBG3u9E_-AnVT5MHm13Hmhz8BaVEOsvmnOgltqPWXSg",
	}
	masterPasswordHash := "086c846547fd8a5750fb8ea740c5e6bb"

	// when
	actualClaims, err := decryptJWE(encryptedJWE, masterPasswordHash)

	// then
	assert.NoError(t, err)
	assert.Equal(t, expectedClaims, actualClaims)
}

func TestDecryptJWE_ShouldNotDecryptValidlyIfWrongPasswordUsed(t *testing.T) {
	// given
	encryptedJWE := "eyJlbmMiOiJBMTI4R0NNIiwiYWxnIjoiZGlyIn0..914U_1q7qRgmah7-.4MqUDKtqo1CH2Y2JcFdsrelwHBBFOK0FJKXGqjwKCXo1XVgm0CuHDh6sBaDKDuDjtYtNW8Mrx_n7NPhWpchbL-ejwI8LWcS4VTBM0sVqMxgzNTckW2vbEXKTnTQlpF_-MIfLFANr5EskLFuUIpeZTBN_KZ5bqeMn5Uwjth0CXrQ6ec_2nSRnK7yMIShCRTjSiOBUhrT-d0tHQjbKXMpqyQ4GQYVwQ5g-wRT7vsOpBBZmw5YpuSeL32ZD7Ltl_bnKAWkis55Uj2nu6oCZN-chqMDDetHjuHYGRSf4GbrGB2mJ_T7EzUjyHVrtAUS6ZYaLTglcrwH1TZ3dIv0oeexDECfrJjvAP_VcNXmgP5OB6_kS937wquuoNgnjTNnMvL9QGNfIbUW4tL7QcGyjJ4ynQcheWAIUPu9Y73Se-9ecDnAr_Tq83EKWUFFyhQb_lTxULtRQ5GqrC-vYeIXy63BsJqSUwr1hPNXP6Pm3_IJzwK4HtjyZWwQzxH3gBogDhP39MB5eRCkUPHaMyLyGZ1PYEUlrXabZp0BsxIDqK6sWlNj0JP63diHb8INLR7ysGD2SMOzsuxfhJtzCnK2SHK5hNOSXpcDYd1mWcKz1lh_iCPk--AYqGX27r2Doa06jFDqeMt31zrulDbwwQgW-_wKtY6VRk-Yb-M8_Dpy-qZFt1GzTObYCa9ovIFqDbt5hUPa_e2EYBesGoDHG4GXz_e4d4ACObJSSxCBt0s9ywgviw-7Oc6aRy6z8u_bqrY315kbQcRI4mFLgWPHgHDZOtEbJDxk-uXdg0DlrecMh2VP1Gfn3JUVCy3TUlc_f-grnQfUWgMrcI0c1jx49rzoVBx7sg0o1jzwQyozYRwKWekS2r-Xi3z1218yfwFNYImaaJgvjbooyvb_gMD3H2Gd6nktLS9hEpaUvJ4rhNiFNgsYuBSg4Pv6u9DPsZyeUDUcUBhX_oh931IVaZj81ZPkfSLuiHWwpNAkhA6KAqn0xl8MSBOMakcY6hZfDSGQwdBBIaCGq_ryRRTDP26Y8LeOt0Kny5qP-b7RcHsiR0gfvrrfqWBE9u9jiMvR5mOnGUKHegSjQpyrSbQO-y-GrX5a_r4_fPWNzyWHXhq88-KfqEegdSxEU4TR4ji2hD1ofhvCQFXstjT6B96YyLxN9855yUzZCjCSFbJ2MVpAnIoVlTiLtLBRTSqkfOI58S5XLw_Bgx98C6cD13XuTs30VnKf28_bDxkyuGqezrTVBjRSSjmKma8KzOpD_97ZO9EZkr2AT5MerN4-_gCbhxthL19HB-RnPHhMHf04KTLmfqojfLeljOobSRMpPkA.X-BZvdm7Nw48ckMrX2cWnA"
	invalidMasterPasswordHash := "8e8210c8d03064930e4ee7f2f1f6e2c2"

	// when
	actualClaims, err := decryptJWE(encryptedJWE, invalidMasterPasswordHash)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldVerifyValidly(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiJ9.eyJwdWJsaWNLZXkiOiItLS0tLUJFR0lOIFJTQSBQVUJMSUMgS0VZLS0tLS1cbk1JSUJDZ0tDQVFFQXRUM2dKQXp2ck5kNHlrTE5GRlN2ZHQvc2owUGpZL3ZmY3R2a003MExWL01rSGZIQTZ2NExcbmdpS3E2TEdYMFlHVERiS0cyRG5hc2JqS3ZwelhDQlR1YnBlUXl4TnI4QnNUL25sVmZQajBRRTZOa2NGcVVqTGVcbkUvaWZldFlwUUtkb1VQRllkSXdUZGZkV3pIN1g4OHIvRkJpSFdZakY1NDEydDVCek9mQkZYMEhoNlpJbkl3clVcbktKZUpBVXljZXFVbGdOWkE0b3k4YkR4TjZkNmdFeHZuYmlOa1lLdzJVN2ZWc25CSzlpajZiSjJYWmRBSlV6TEZcbk1MUWc0SW5LeXB5RzNXVitSZXlKQzlFY0p5NnRuZk82NHJtd0tlQTl1a2J1aXFva1laM2I1NE5pMkZTVGdaaUdcbno2aVBXMURqWFg5WXhSSVNoTHpZMkJzazU4dHVUWUdTMXdJREFRQUJcbi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTc1MjE1NDkzN30.LLD-jQJmw3oEX-RYv8bO0wW5aG3FkeIlTU9lq17nPtXWB9Ino5kzrBKU8Dm8RcD3juj2HA-bfo8_fNj8TW2Xvt1yPQqanIxfL2q0t4aNroysel9Ue2A6ctr5dFDQE2UINzNa8t6kZM6Stdgz5FGhOKbS-3ZmYcKNdAD182-uJwgD3MEbFIEvfoGYbTdx5E3BulJWEDLnuWZpnmm1p4oZ83pEUuOYC8h6jD2PBPEBrPSeGK9ojCV6n6JkOk6nASzn0SSZycoKhyrG7efy3emC4s6QbHIa47ehVARMIOyl4SaNBG3u9E_-AnVT5MHm13Hmhz8BaVEOsvmnOgltqPWXSg"}
	expectedClaims := &registerJWSClaims{
		IssuedAt:  1752154937,
		PublicKey: "-----BEGIN RSA PUBLIC KEY-----\nMIIBCgKCAQEAtT3gJAzvrNd4ykLNFFSvdt/sj0PjY/vfctvkM70LV/MkHfHA6v4L\ngiKq6LGX0YGTDbKG2DnasbjKvpzXCBTubpeQyxNr8BsT/nlVfPj0QE6NkcFqUjLe\nE/ifetYpQKdoUPFYdIwTdfdWzH7X88r/FBiHWYjF5412t5BzOfBFX0Hh6ZInIwrU\nKJeJAUyceqUlgNZA4oy8bDxN6d6gExvnbiNkYKw2U7fVsnBK9ij6bJ2XZdAJUzLF\nMLQg4InKypyG3WV+ReyJC9EcJy6tnfO64rmwKeA9ukbuiqokYZ3b54Ni2FSTgZiG\nz6iPW1DjXX9YxRIShLzY2Bsk58tuTYGS1wIDAQAB\n-----END RSA PUBLIC KEY-----\n",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1752154947, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.NoError(t, err)
	assert.Equal(t, expectedClaims, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenExpired(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529844, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenInvalidJWSFormat(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "JhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenInvalidPublicKeyFormat(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGxoNUl5UzZMMVAzTVxuTWg1T093dVF5V0FHcU40VjljbWxiWm9UZVlFTUViSVJJS2NnbGx2aXBKZnVqVGZjWit2NlZyYXEyMndVZnpBaVxuZWd2QWt1ZitDTjUreE5KYzArRmVKWE5uSUUrdlJsbGg5blErQWhFSytadnRaTGdXWGNkM3c0RFlPVFREeFRiZVxueHBWNitJY0djekF0M29ZUVdtYU96MDRSRzlxS3ozN3huY21taWZ4Q2NQc3hzNldxTXdMcUJwL1dRaktmZ1lWV1xuQ3dJREFRQUJcbiJ9.ojQcHiBuWG0Q5rqA3VxWhF4AKcnPThvUK-eeGSLBMkdKVTt4mlu6BYXI04KdfJCEzgiTr2iJ18_VKuWNi8bQHPgkKTHW99mMUkOrA3DLLVkM11rIgifeTZgtVbx33qCIq-NXNr_xVwXtjy5rkgHWYdS3NZlmQ7EcS4jzRyqdr0V9uE0X_olrhOimC-bbWNkEyugcvhm6k4T3tzcUfR5DZN7i7MVMNbdkHnibG0ZS9OnhvCZtcK0hw5LhN0nX3fpRImeSiOtZYTK-4fSqaGQZpbdTHSoo6PbbXPAvgW88Dn4bWO0r3ew6mpSJhJ5i8Ms0IotrlTQVCiuM51ezlTpATQ",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenDifferentPublicKeyInPayloadThanUsedForSigning(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiJ9.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW1ZZXRDK0lRWGF1cm5RRTRYV25BXG5RUVlxYVZUbzVSQkV1dXlhM0xWVnZGVmJRQVJlUk1xQUhMakpMaFZQR3pITVNJOXVhVnhlbTBvY1Rlc1V0RE83XG43c2hhZUIyOFFyMERvQWZqVmxyeGpXUEhSN0V4V0NkejZYeWluWHdQZEg4SFBEVEZoMFhxcWN1S29ZSzZwNWJpXG51NWl0WE5DNDhtSWluZ2JWaEpaRThJeVN6ZThLT2g3RTRmeVZrS1NCcW96amczYmtOVVZjM2lLNFIxZ0ZkQ3paXG4zcFNuMEY3TkNyUHN4WU03MDFRZ1VCNThhM3ZGK25KNmhkVnNKaW5OOFJaUmQ0MjRuU0MwUmtCMlg1blJUUFF2XG5jSzJoN09pdm9oa2VTZG05am1TR056YXA5dmk4ZURDVnFSRE1oL0VkMlFZWmpOWEFBMGt2bmZXdUd0U05zK0kyXG5Pd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.wGQouBVYp4MuUs-Xps4Bkt9mXlrvb8wsRSNt2R-siWUAOXubYNr_IbCU2OsY-t6eKUsrpZvUoiPRcSXoOmjjCKq-_TnilOg_daqN6pJQlnu0FeImvKnmJ6aSudgGPX9kET7B4B9z6ExH2SgjxaggYLYxq4OeLe4lAYFkp4zD5TmCC6FUyT9ivF_x8DbZI5AIadg1KDc7JvlRfc3bnBzFfOK-Y1Lpme2LRVLYPI38CGXsOFCpA6_ofEWxVPsQQTKiDAdx085M1-FgnfbHBfkhiaG-bYBYVWG6-1JCuVdf5WU-GTBUUOvG4bBR6x46ekyJyfRyBa1cHXaEQj8j5901ZA",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}
