package owner

import (
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

var publicKey2048 string = "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxlPQeyWqaHa0C8X3USEC\n6dNYy3bWuGsQVfzShviTpepswR3heHNUvVNKquXdvZl8RbCrvQcZ01vvJS+iAMnP\njRqx20KGo6NupHHZIeamBGeCOSX46kymgAF6vGzsd9nQRzhhz4xGlh5IyS6L1P3M\nMh5OOwuQyWAGqN4V9cmlbZoTeYEMEbIRIKcgllvipJfujTfcZ+v6Vraq22wUfzAi\negvAkuf+CN5+xNJc0+FeJXNnIE+vRllh9nQ+AhEK+ZvtZLgWXcd3w4DYOTTDxTbe\nxpV6+IcGczAt3oYQWmaOz04RG9qKz37xncmmifxCcPsxs6WqMwLqBp/WQjKfgYVW\nCwIDAQAB\n-----END PUBLIC KEY-----"
var privateKey2048 string = "-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAxlPQeyWqaHa0C8X3USEC6dNYy3bWuGsQVfzShviTpepswR3h\neHNUvVNKquXdvZl8RbCrvQcZ01vvJS+iAMnPjRqx20KGo6NupHHZIeamBGeCOSX4\n6kymgAF6vGzsd9nQRzhhz4xGlh5IyS6L1P3MMh5OOwuQyWAGqN4V9cmlbZoTeYEM\nEbIRIKcgllvipJfujTfcZ+v6Vraq22wUfzAiegvAkuf+CN5+xNJc0+FeJXNnIE+v\nRllh9nQ+AhEK+ZvtZLgWXcd3w4DYOTTDxTbexpV6+IcGczAt3oYQWmaOz04RG9qK\nz37xncmmifxCcPsxs6WqMwLqBp/WQjKfgYVWCwIDAQABAoIBAF6SSwDeFiNYL0TJ\n8sQR/MSpTlc/ZOZtz01hkLZhxG5CmfeAmyqHvGnHVPynPhSSIwtMUqiBwVPjK+dM\njnDXywvbJeKLF47iePkbfNHInXPOM++yZr67LE4v5moBesUv7Tx461M/7czZxhWB\nB5baK0ve3akUO8d67dIKjOg2bpcTIP421XTd1JUPVAMmx7lyz0gDiqgaQVWt8ftX\nXf4fRijVfHvwyPOqO0Jh/EJD7a1vdK2wtW7V3LAMzz0SikcPu1qwqBz08GV4NaFY\nYGRdSMn4KGh9lhA64PvAiGZwWbrDi90BAxfI4eDCXCsHESxRlx82HduhHaSR4V4S\nTc/uFMkCgYEA9QIOuVcwCZy+oEUsicBc7hpyFcqyjwobUKvmWHgyaylcxgf1O5cK\nMaRUGvTiwdrkmUhAUDoiTvKgf4alICjH+4D63a3ETv+NeEODDE2tuGvWcei11HR8\n+s1LjMiO72bAhqehpEtjL6odvjUUIMb9LfGkTbnZl1+vphe1YnP3xHUCgYEAzzmf\n/JH/V8dgR7219ow/MKAZUWB90QqJxo1B8fMTJLLU5UgeLThjKFlkGIiUEbmam4Eq\nx6Kna2/yH/b6tncxn0fZrEaw1FJXuyMu0JnvfOocOs4Nz0Lr1/Y5cIhGwBvgP2es\nbYBMqkGOfdovNaYSAdFpekbjkWdEjBPh+SZTYH8CgYAyFJ2V3PCAxn1gnUMhVSSp\nttYjBi/BdTtoHfsTkl4b8XR5Nh82cwUuaHyYlf3Tyj535oDe5UMmCAouhwMxs6RN\nEGw269H4o9vy/TnIRgiAbeqDliG0r6rsSRJsUIKHBOXNoG41+wLnN0qlGoxmtsYB\noicHjDmh63kn5ii5WyMGEQKBgQCTben25WAG8V/8amolCE6Ep8KbdMzOhnLTAfii\nzE8YUurIXPCrN2zEbiSal8DQg34NmG35Li1ycGiQeUSRwGdbbODegkSYKiUkjLln\ny7zo4B5JcAO/K1tjgFgJScscLjjyoy23kgn5Lz7TJwFjZ81z4arrRbft4MyR5Ctm\n+O9kvQKBgDq5tQAkFV1lDS1ztBhlXjaDyX3397/1yzEPGrtbAkbzNB6zE4Xh/XgU\nNT0OjFjDDx03KkZ22KDNHgyiNFB9Pt4AOqyisKkWcnVT76zNT4PjxQHHn9YfIXgJ\nMopE7XbdfvjwO6Wp4W6X0/Gk+kVIqlA9KKiDqOyxD0yipOBIWqPu\n-----END RSA PRIVATE KEY-----"

func TestDecryptJWE_ShouldDecryptValidly(t *testing.T) {
	// given
	encryptedJWE := "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..1Y5iVqv-DvY5Wde5.8hngWHBtz0cRo0A2EIvB87awRrfOqhiYCn29u7J8gprIjqtWQ6wt9ls7FZ_u-w-2pDdBbu779jfzcFCFqZ-_xHd0DW2j7IRxnlxBC6FrkHXsnD9fK_SAenyI2HIyyq_pnRPtCOghyMAGKx24pQpi4Z2Ak-UFR9NTCgo9RyZ3ekYGT325M6zAQtzL0m61XykLWriz3WJ2aKeC0lJIUDx8Y-3LedmigpTDmdgSSi7Y8QpQswXYQijfup6JuEXYH_ZDTNcsQYnOi_SFPViqfTcGBeaNXhX9H9nmGt2Ibo_ShEqyBXMZiS9CMawpKM7XPj0cvrO-d_sFaW_5ulsr4iaOoWA5-AEJe_gqUoa5GE1O-CawTR3Cx-THGHihOnVoRI3QN7fx7HMjTb0Cxb1EyE8m8uzTpbYK0arRpXsxa0SRpHqdXX7BRfqU1mBrNDjC3QubCTASTJ-0E0NpuJjprPJIYP78SENzKql5FzHxvF3KYOqBSRrj92mn15kxmYLGw1J2gkxcieHA2-_AlEiwZ5eocvy1CuXQ_-0o7ZnpwPxbh3ZcdYTHmjQCa0uw9I2V-yqjaFdPfnaqHDbFT6cOf3LEHAfaRDbhJpyFxqKMRnixXrRkwD3DV-2eMIDnZ9R9-1DJ5Oy7HtIXSLTI-PYN5WB-vrI61a9APgGWplA3wMD1y54QmTDTm_WG-2Eb3XvfFfgnMpw2YM1O35N3D8OLE5BQel6JMqcU8pY5W8Uov0e5tfepBMjvI7vZME40V34S_59bKF-ddeuflaEe1apBlgoqTJK36BpaPuTLawhgzu6IrLP16p53qP0iUZrCPxEaYtV7nNqhEqbzXn0pd-BYsivLD4IKDFxljgJj1F6Rhw-QdQFfiiWhGiMfMQn0K6vG3LuenS4dIEdz8Eu1NbZF5yju6xwN002UcSlhZiMnwJvQF31wai3ueuZArvAGKsG6aQO-JsXZqi9No2-hExNiMoUbbqjLNU-6Lceqb41YbupXtFfaGPWKTpQxCG6d-2htceZuNleO7dH-TuBC7OEa1A0LsZN6QYpwiWHeWBGVKOaHkACTp13nc4_8m-d6-fVgKlmOqcbZ6eDVbgJrM4ajYna557_-oBVPlITq3ndoL05zs2KQrT27HvNsN1RNrCa6wCJIK2jiiut1t_jmxBf5a8nw1yn7aN7Jv6JGfkziJT_rVJZaLTrh9sQcGMrcDli37XAlNihUf-kYtorkAkF5jxza6smhIim-mYm9c0wCHEBxekta8Eeb3iHCVdTyFy9ulbJBj8u_Dkj4CpwQYRtb4KXj5enEIMUNM43EfTvTMqGowSJhQ99jei1Vk0hTS0-UUfd7Z9QmiOFqWHGZ2zn66C29quoqbP3GyTKCLE5DKIGMfeFzaMQW3JaeFg.qJR4FwBwpkbVb1kxKOclkw"
	expectedClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	masterPasswordHash := "086c846547fd8a5750fb8ea740c5e6bb"

	// when
	actualClaims, err := decryptJWE(encryptedJWE, masterPasswordHash)

	// then
	assert.NoError(t, err)
	assert.Equal(t, expectedClaims, actualClaims)
}

func TestDecryptJWE_ShouldNotDecryptValidlyIfWrongPasswordUsed(t *testing.T) {
	// given
	encryptedJWE := "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..1Y5iVqv-DvY5Wde5.8hngWHBtz0cRo0A2EIvB87awRrfOqhiYCn29u7J8gprIjqtWQ6wt9ls7FZ_u-w-2pDdBbu779jfzcFCFqZ-_xHd0DW2j7IRxnlxBC6FrkHXsnD9fK_SAenyI2HIyyq_pnRPtCOghyMAGKx24pQpi4Z2Ak-UFR9NTCgo9RyZ3ekYGT325M6zAQtzL0m61XykLWriz3WJ2aKeC0lJIUDx8Y-3LedmigpTDmdgSSi7Y8QpQswXYQijfup6JuEXYH_ZDTNcsQYnOi_SFPViqfTcGBeaNXhX9H9nmGt2Ibo_ShEqyBXMZiS9CMawpKM7XPj0cvrO-d_sFaW_5ulsr4iaOoWA5-AEJe_gqUoa5GE1O-CawTR3Cx-THGHihOnVoRI3QN7fx7HMjTb0Cxb1EyE8m8uzTpbYK0arRpXsxa0SRpHqdXX7BRfqU1mBrNDjC3QubCTASTJ-0E0NpuJjprPJIYP78SENzKql5FzHxvF3KYOqBSRrj92mn15kxmYLGw1J2gkxcieHA2-_AlEiwZ5eocvy1CuXQ_-0o7ZnpwPxbh3ZcdYTHmjQCa0uw9I2V-yqjaFdPfnaqHDbFT6cOf3LEHAfaRDbhJpyFxqKMRnixXrRkwD3DV-2eMIDnZ9R9-1DJ5Oy7HtIXSLTI-PYN5WB-vrI61a9APgGWplA3wMD1y54QmTDTm_WG-2Eb3XvfFfgnMpw2YM1O35N3D8OLE5BQel6JMqcU8pY5W8Uov0e5tfepBMjvI7vZME40V34S_59bKF-ddeuflaEe1apBlgoqTJK36BpaPuTLawhgzu6IrLP16p53qP0iUZrCPxEaYtV7nNqhEqbzXn0pd-BYsivLD4IKDFxljgJj1F6Rhw-QdQFfiiWhGiMfMQn0K6vG3LuenS4dIEdz8Eu1NbZF5yju6xwN002UcSlhZiMnwJvQF31wai3ueuZArvAGKsG6aQO-JsXZqi9No2-hExNiMoUbbqjLNU-6Lceqb41YbupXtFfaGPWKTpQxCG6d-2htceZuNleO7dH-TuBC7OEa1A0LsZN6QYpwiWHeWBGVKOaHkACTp13nc4_8m-d6-fVgKlmOqcbZ6eDVbgJrM4ajYna557_-oBVPlITq3ndoL05zs2KQrT27HvNsN1RNrCa6wCJIK2jiiut1t_jmxBf5a8nw1yn7aN7Jv6JGfkziJT_rVJZaLTrh9sQcGMrcDli37XAlNihUf-kYtorkAkF5jxza6smhIim-mYm9c0wCHEBxekta8Eeb3iHCVdTyFy9ulbJBj8u_Dkj4CpwQYRtb4KXj5enEIMUNM43EfTvTMqGowSJhQ99jei1Vk0hTS0-UUfd7Z9QmiOFqWHGZ2zn66C29quoqbP3GyTKCLE5DKIGMfeFzaMQW3JaeFg.qJR4FwBwpkbVb1kxKOclkw"
	invalidMasterPasswordHash := "8e8210c8d03064930e4ee7f2f1f6e2c2"

	// when
	actualClaims, err := decryptJWE(encryptedJWE, invalidMasterPasswordHash)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldVerifyValidly(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	expectedClaims := &registerJWSClaims{
		IssuedAt:  1738529641,
		PublicKey: "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxlPQeyWqaHa0C8X3USEC\n6dNYy3bWuGsQVfzShviTpepswR3heHNUvVNKquXdvZl8RbCrvQcZ01vvJS+iAMnP\njRqx20KGo6NupHHZIeamBGeCOSX46kymgAF6vGzsd9nQRzhhz4xGlh5IyS6L1P3M\nMh5OOwuQyWAGqN4V9cmlbZoTeYEMEbIRIKcgllvipJfujTfcZ+v6Vraq22wUfzAi\negvAkuf+CN5+xNJc0+FeJXNnIE+vRllh9nQ+AhEK+ZvtZLgWXcd3w4DYOTTDxTbe\nxpV6+IcGczAt3oYQWmaOz04RG9qKz37xncmmifxCcPsxs6WqMwLqBp/WQjKfgYVW\nCwIDAQAB\n-----END PUBLIC KEY-----",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.NoError(t, err)
	assert.Equal(t, expectedClaims, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenExpired(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529844, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenInvalidJWSFormat(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "JhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGh6NHhHbGg1SXlTNkwxUDNNXG5NaDVPT3d1UXlXQUdxTjRWOWNtbGJab1RlWUVNRWJJUklLY2dsbHZpcEpmdWpUZmNaK3Y2VnJhcTIyd1VmekFpXG5lZ3ZBa3VmK0NONSt4TkpjMCtGZUpYTm5JRSt2UmxsaDluUStBaEVLK1p2dFpMZ1dYY2QzdzREWU9UVER4VGJlXG54cFY2K0ljR2N6QXQzb1lRV21hT3owNFJHOXFLejM3eG5jbW1pZnhDY1BzeHM2V3FNd0xxQnAvV1FqS2ZnWVZXXG5Dd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.dwG8IocXWuDfTfTUZfaNv-7dfA-FHZx6Ztox6MEnEaziTvnPZ_Js43V4rWaUOP_mxYHmQ0y357OIj0nVTwTAWvZGWPqM9ExGpFvSSTziSCICmu8pMbjW2Y2LEbesiR5eBnU1B7_GyUHmoOB6ums2Eb21pwv5HYYLsD8gF3SA1T1gO1ps-hdLLYYomP_BY_FdMO_DDUt6I7WyxVyEc3SG3mlxEllS2vO2WdF8XIpXnlJi3HCPKViS7-NwpCVSMpQhb-YpLMg_gELFF7Gqu-WxVsK7R0Ntnx9wgHShAtnDCdoHUi743XIUH7P2Cb0_xUdG3lQp0761g0hiNaqbtuYE_Q",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenInvalidPublicKeyFormat(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiIsInByb3BYIjpmYWxzZX0.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhsUFFleVdxYUhhMEM4WDNVU0VDXG42ZE5ZeTNiV3VHc1FWZnpTaHZpVHBlcHN3UjNoZUhOVXZWTktxdVhkdlpsOFJiQ3J2UWNaMDF2dkpTK2lBTW5QXG5qUnF4MjBLR282TnVwSEhaSWVhbUJHZUNPU1g0Nmt5bWdBRjZ2R3pzZDluUVJ6aGxoNUl5UzZMMVAzTVxuTWg1T093dVF5V0FHcU40VjljbWxiWm9UZVlFTUViSVJJS2NnbGx2aXBKZnVqVGZjWit2NlZyYXEyMndVZnpBaVxuZWd2QWt1ZitDTjUreE5KYzArRmVKWE5uSUUrdlJsbGg5blErQWhFSytadnRaTGdXWGNkM3c0RFlPVFREeFRiZVxueHBWNitJY0djekF0M29ZUVdtYU96MDRSRzlxS3ozN3huY21taWZ4Q2NQc3hzNldxTXdMcUJwL1dRaktmZ1lWV1xuQ3dJREFRQUJcbiJ9.ojQcHiBuWG0Q5rqA3VxWhF4AKcnPThvUK-eeGSLBMkdKVTt4mlu6BYXI04KdfJCEzgiTr2iJ18_VKuWNi8bQHPgkKTHW99mMUkOrA3DLLVkM11rIgifeTZgtVbx33qCIq-NXNr_xVwXtjy5rkgHWYdS3NZlmQ7EcS4jzRyqdr0V9uE0X_olrhOimC-bbWNkEyugcvhm6k4T3tzcUfR5DZN7i7MVMNbdkHnibG0ZS9OnhvCZtcK0hw5LhN0nX3fpRImeSiOtZYTK-4fSqaGQZpbdTHSoo6PbbXPAvgW88Dn4bWO0r3ew6mpSJhJ5i8Ms0IotrlTQVCiuM51ezlTpATQ",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}

func TestVerifyJWS_ShouldNotVerifyWhenDifferentPublicKeyInPayloadThanUsedForSigning(t *testing.T) {
	// given
	jwsClaims := &registerJWEClaims{
		JWS: "eyJhbGciOiJSUzI1NiJ9.eyJpYXQiOjE3Mzg1Mjk2NDEsInB1YmxpY0tleSI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW1ZZXRDK0lRWGF1cm5RRTRYV25BXG5RUVlxYVZUbzVSQkV1dXlhM0xWVnZGVmJRQVJlUk1xQUhMakpMaFZQR3pITVNJOXVhVnhlbTBvY1Rlc1V0RE83XG43c2hhZUIyOFFyMERvQWZqVmxyeGpXUEhSN0V4V0NkejZYeWluWHdQZEg4SFBEVEZoMFhxcWN1S29ZSzZwNWJpXG51NWl0WE5DNDhtSWluZ2JWaEpaRThJeVN6ZThLT2g3RTRmeVZrS1NCcW96amczYmtOVVZjM2lLNFIxZ0ZkQ3paXG4zcFNuMEY3TkNyUHN4WU03MDFRZ1VCNThhM3ZGK25KNmhkVnNKaW5OOFJaUmQ0MjRuU0MwUmtCMlg1blJUUFF2XG5jSzJoN09pdm9oa2VTZG05am1TR056YXA5dmk4ZURDVnFSRE1oL0VkMlFZWmpOWEFBMGt2bmZXdUd0U05zK0kyXG5Pd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIn0.wGQouBVYp4MuUs-Xps4Bkt9mXlrvb8wsRSNt2R-siWUAOXubYNr_IbCU2OsY-t6eKUsrpZvUoiPRcSXoOmjjCKq-_TnilOg_daqN6pJQlnu0FeImvKnmJ6aSudgGPX9kET7B4B9z6ExH2SgjxaggYLYxq4OeLe4lAYFkp4zD5TmCC6FUyT9ivF_x8DbZI5AIadg1KDc7JvlRfc3bnBzFfOK-Y1Lpme2LRVLYPI38CGXsOFCpA6_ofEWxVPsQQTKiDAdx085M1-FgnfbHBfkhiaG-bYBYVWG6-1JCuVdf5WU-GTBUUOvG4bBR6x46ekyJyfRyBa1cHXaEQj8j5901ZA",
	}
	timeNowFunc = func() time.Time {
		return time.Unix(1738529644, 0)
	}

	// when
	actualClaims, err := verifyJWS(jwsClaims.JWS, 10)

	// then
	assert.Error(t, err)
	assert.Nil(t, actualClaims)
}
